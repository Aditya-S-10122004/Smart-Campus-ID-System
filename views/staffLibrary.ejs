<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Campus ID System</title>

    <script>
      (function () {
        try {
          const saved = localStorage.getItem("sc_theme");
          if (saved === "dark") {
            document.documentElement.classList.add("dark");
            document.body.classList.add("dark");
          }
        } catch (e) {
            console.log(err);
        }
      })();
    </script>

    <link rel="stylesheet" href="/style/staffLibrary.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="sm-header">
      <div class="sm-brand">SDMCET</div>
      <div class="sm-header-right">
        <button id="themeToggle" class="sm-theme-toggle">ðŸŒž Light</button>
        <a href="/logout" class="sm-signout">Sign Out</a>
      </div>
    </header>

    <!-- MAIN -->
    <main class="sm-main">
      <div class="sm-card">
        <div class="sm-user-block">
          <div class="sm-user-title">User : Library</div>
          <div class="sm-user-sub"><i>Staff type : Library</i></div>
        </div>

        <!-- Borrow Form -->
        <form class="lib-form" method="POST" action="/staff/library/borrow">
          <div>
            <label>Student USN</label>
            <input type="text" name="usn" required />
          </div>

          <div>
            <label>Book Name</label>
            <input type="text" name="title" required />
          </div>

          <button type="submit">Add</button>
        </form>

        <!-- Borrowed Books Table -->
        <div class="lib-table-wrap">
          <h3>Borrowed Books</h3>

          <table>
            <thead>
              <tr>
                <th>USN</th>
                <th>Name</th>
                <th>Book</th>
                <th>Date of Borrow</th>
                <th>Due Date</th>
                <th>Total Fine</th>
              </tr>
            </thead>
            <tbody>
              <% if (borrowedBooks && borrowedBooks.length) { %> <%
              borrowedBooks.forEach(function(b) { %>
              <tr>
                <td><%= b.usn %></td>
                <td><%= b.name %></td>
                <td><%= b.title %></td>
                <td><%= b.issued_on %></td>
                <td><%= b.due_on %></td>
                <td class="fine-box"><%= b.fine === 0 ? "No dues" : "â‚¹ " + b.fine %></td>
              </tr>
              <% }) %> <% } else { %>
              <tr>
                <td colspan="5">No borrowed books</td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="sm-footer">SDMCET | Â© 2025 Smart Campus ID System</footer>

    <!-- THEME TOGGLE -->
    <script>
      const toggle = document.getElementById("themeToggle");
      toggle.onclick = () => {
        document.documentElement.classList.toggle("dark");
        document.body.classList.toggle("dark");
        localStorage.setItem(
          "sc_theme",
          document.body.classList.contains("dark") ? "dark" : "light"
        );
        toggle.textContent = document.body.classList.contains("dark") ? "ðŸŒ™ Dark" : "ðŸŒž Light" ;
      };
    </script>
  </body>
</html>
