<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Library Staff</title>

    <script>
      (function () {
        try {
          const saved = localStorage.getItem("sc_theme");
          if (saved === "dark") {
            document.documentElement.classList.add("dark");
            document.body.classList.add("dark");
          }
        } catch (e) {}
      })();
    </script>

    <link rel="stylesheet" href="/style/staffLibrary.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="sm-header">
      <div class="sm-brand">SDMCET</div>
      <div class="sm-header-right">
        <button id="themeToggle" class="sm-theme-toggle">ðŸŒž Light</button>
        <a href="/logout" class="sm-signout">Sign Out</a>
      </div>
    </header>

    <!-- MAIN -->
    <main class="sm-main">
      <div class="sm-card">
        <div class="sm-user-block">
          <div class="sm-user-title">User : Library</div>
          <div class="sm-user-sub"><i>Staff type : Library</i></div>
        </div>

        <!-- Borrow Form -->
        <form
          action="/staff/library/borrow"
          method="POST"
          class="lib-form"
          autocomplete="off"
        >
          <!-- USN -->
          <div>
            <label for="usn">Student USN</label>
            <input
              type="text"
              id="usn"
              name="usn"
              placeholder="2SD23IS001"
              required
            />
          </div>

          <!-- Book Title -->
          <div>
            <label for="title">Book Title</label>
            <input
              type="text"
              id="title"
              name="title"
              placeholder="Operating Systems"
              required
            />
          </div>

          <!-- Author -->
          <div>
            <label for="author">Author</label>
            <input
              type="text"
              id="author"
              name="author"
              placeholder="Abraham Silberschatz"
            />
          </div>

          <!-- Book ID -->
          <div>
            <label for="book_id">Book ID</label>
            <input
              type="text"
              id="book_id"
              name="book_id"
              placeholder="LIB-OS-102"
            />
          </div>

          <!-- Book Edition -->
          <div>
            <label for="book_edition">Book Edition</label>
            <input
              type="text"
              id="book_edition"
              name="book_edition"
              placeholder="9th Edition"
            />
          </div>

          <!-- Submit -->
          <div>
            <button type="submit">Add Book</button>
          </div>
        </form>

        <!-- Borrowed Books Table -->
        <div class="lib-table-wrap">
          <h3>Borrowed Books</h3>

          <table>
            <thead>
              <tr>
                <th>USN</th>
                <th>Name</th>
                <th>Title</th>
                <th>Author</th>
                <th>Book ID</th>
                <th>Edition</th>
                <th>Issued On</th>
                <th>Due On</th>
                <th>Fine (â‚¹)</th>
              </tr>
            </thead>

            <tbody>
              <% if (borrowedBooks.length === 0) { %>
              <tr>
                <td colspan="9" style="text-align: center">No records found</td>
              </tr>
              <% } %> <% borrowedBooks.forEach((b) => { %>
              <tr>
                <td><%= b.usn %></td>
                <td><%= b.name %></td>
                <td><%= b.title %></td>
                <td><%= b.author || "-" %></td>
                <td><%= b.book_id || "-" %></td>
                <td><%= b.book_edition || "-" %></td>
                <td><%= b.issued_on %></td>
                <td><%= b.due_on %></td>
                <td class="fine-box">
                  <%= b.fine === 0 ? "No dues" : b.fine %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="sm-footer">SDMCET | Â© 2025 Smart Campus ID System</footer>

    <!-- THEME TOGGLE -->
    <script>
      const toggle = document.getElementById("themeToggle");
      toggle.onclick = () => {
        document.documentElement.classList.toggle("dark");
        document.body.classList.toggle("dark");
        localStorage.setItem(
          "sc_theme",
          document.body.classList.contains("dark") ? "dark" : "light"
        );
        toggle.textContent = document.body.classList.contains("dark")
          ? "ðŸŒ™ Dark"
          : "ðŸŒž Light";
      };
    </script>
  </body>
</html>
